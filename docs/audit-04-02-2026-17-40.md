Audit complet du projet CashPilot
Vue d'ensemble
CashPilot est une plateforme de gestion financiÃ¨re construite avec React 18 + Vite 5, Tailwind CSS, Supabase (PostgreSQL), et supporte 3 langues (EN/FR/NL). Le projet compte ~50+ composants, 39 hooks custom, 19 pages, et couvre : gestion de projets, facturation, devis, suivi du temps, fournisseurs, comptabilite, stock, et analytique.

1. PROBLEMES CRITIQUES
1.1 Credentials Supabase en dur dans le code source
Fichier: src/lib/customSupabaseClient.js:3-4
Probleme: URL et clef anon Supabase hardcodees, exposees dans l'historique Git
Impact: Acces non autorise potentiel a la base de donnees
Correction: Supprimer les credentials hardcodees, utiliser exclusivement import.meta.env.VITE_SUPABASE_URL et import.meta.env.VITE_SUPABASE_ANON_KEY, faire une rotation de la clef exposee
1.2 Deux implementations AuthContext concurrentes
Fichiers: src/context/AuthContext.jsx ET src/contexts/SupabaseAuthContext.jsx
Probleme: Deux providers d'authentification differents, source de confusion et de bugs potentiels
Impact: Comportement imprevisible si le mauvais contexte est utilise
Correction: Consolider en un seul AuthContext, supprimer l'implementation inutilisee
1.3 Race condition dans useSubtasks (realtime)
Fichier: src/hooks/useSubtasks.js:113-139
Probleme: Les subscriptions Supabase Realtime s'empilent si taskId change rapidement. Pas de unsubscribe avant re-subscription
Impact: Fuite memoire, callbacks multiples, donnees incoherentes
Correction: Tracker la subscription dans un ref, unsubscribe dans le cleanup du useEffect
2. PROBLEMES HAUTE PRIORITE
2.1 Debug Panel expose en production
Fichier: src/components/settings/ProfileSettings.jsx:500-566
Probleme: Panel debug Supabase visible dans l'UI de production avec des logs d'evenements en temps reel
Correction: Conditionner l'affichage a import.meta.env.DEV
2.2 Console.log excessifs (49 fichiers)
Fichiers principaux: src/hooks/useAuth.js, src/lib/supabase.js, et pratiquement tous les hooks
Probleme: Informations de debug exposees en console navigateur en prod
Correction: Supprimer ou gater derriere import.meta.env.DEV
2.3 localStorage.clear() au logout
Fichier: src/hooks/useAuth.js:29
Probleme: Efface TOUTES les preferences utilisateur (langue, sidebar, etc.) au logout
Correction: Utiliser localStorage.removeItem() uniquement sur les cles d'auth
2.4 Offline sync non implemente
Fichier: src/hooks/useOfflineSync.js:49-67
Probleme: La logique de synchronisation est stubbee avec un commentaire // Here you would implement the actual sync logic...
Impact: Les donnees modifiees hors-ligne ne seront jamais synchronisees
2.5 setTimeout sans cleanup dans les settings
Fichiers: src/hooks/useBillingSettings.js:42-46, src/hooks/useNotificationSettings.js:28-42
Probleme: setTimeout non annule si le composant est demonte -> fuite memoire et setState sur composant demonte
2.6 Clef VAPID hardcodee
Fichier: src/hooks/usePushNotifications.js:46
Probleme: Clef publique VAPID hardcodee au lieu d'etre en variable d'environnement
3. PROBLEMES MOYENS
3.1 Appels API dupliques
Fichiers: Tous les hooks de donnees (useProjects, useClients, useInvoices, etc.)
Probleme: Chaque composant qui utilise un hook effectue son propre appel API. Pas de cache, pas de deduplication
Correction: Adopter React Query / TanStack Query ou SWR pour le cache et la deduplication
3.2 Pas de TypeScript
Projet entierement en JavaScript/JSX
Types definis uniquement via JSDoc dans src/types/index.js (non enforces)
Pas de validation a la compilation
Props de composants non types
3.3 Pas de Error Boundaries
Aucun Error Boundary dans l'arbre de composants
Une erreur non geree dans un hook peut crasher toute l'application
3.4 Gestion RLS silencieuse
Fichiers: useProjects.js:33-36, useClients.js:34-39, useInvoices.js:41-45
Probleme: Les erreurs RLS (42P17, 42501) retournent silencieusement un tableau vide
L'utilisateur ne sait pas s'il n'a pas de donnees ou s'il manque de permissions
3.5 Pas de validation runtime des donnees
Zod est installe (zod@^3.22.4) mais n'est utilise nulle part pour valider les donnees avant envoi a l'API
Les operations CRUD acceptent n'importe quelle donnee
3.6 Dependances manquantes dans useEffect
Fichiers: useProjects.js:155-157, useClients.js:145-147, useInvoices.js:197-199, useExpenses.js:75-77
Probleme: fetchX n'est pas dans le tableau de dependances -> closures potentiellement perimees
4. INTERNATIONALISATION (i18n)
4.1 Structure i18n : Bonne
3 fichiers de traduction complets (en.json, fr.json, nl.json) avec 160 cles chacun
Detection automatique de la langue du navigateur
4.2 Chaines hardcodees : ~70+ occurrences non traduites
Fichier	Nb de chaines hardcodees	Exemples
src/pages/LoginPage.jsx	12+	"Welcome back, Pilot!", "Se connecter" (FR hardcode)
src/components/MainLayout.jsx	8+	"Projects", "Suppliers", "Settings"
src/pages/Dashboard.jsx	7+	"Total Revenue", "Profit Margin"
src/components/TaskForm.jsx	10+	"Title", "Status", "Priority", statuts et priorites
src/pages/ProjectsPage.jsx	5+	"Active", "Progress", "View Details"
src/components/BarcodeScanner.jsx	8+	"Scanner", "Camera Inactive", "Start Camera"
src/pages/QuotesPage.jsx	6+	"Quotes", "Create Quote"
src/components/TimesheetForm.jsx	4+	"Project", "Cancel"
src/components/ReportGenerator.jsx	1+	"Report Generator"
4.3 LoginPage melange les langues
Contient du francais hardcode ("Se connecter", "Connexion reussie") melange a de l'anglais
5. FONCTIONNALITES INCOMPLETES
Fonctionnalite	Fichier	Etat
Page Devis (Quotes)	src/pages/QuotesPage.jsx	Placeholder uniquement, aucune fonctionnalite
Report Generator	src/components/ReportGenerator.jsx	Donnees mockees ("$124,500.00", "14 projects")
Barcode Scanner	src/components/BarcodeScanner.jsx	UI limitee, pas d'integration reelle de lecture
Offline Sync	src/hooks/useOfflineSync.js	Logique de sync stubbee
Biometric Auth	src/hooks/useBiometric.js	Simplifie pour demo, pas de verification server-side
6. ACCESSIBILITE
Boutons avec icones uniquement sans aria-label (Navigation, BarcodeScanner, MainLayout)
Pas de texte alt sur les avatars de profil
SVG HeroImage sans label descriptif
Points positifs : role="alert" sur les alertes, HTML semantique dans les tables, htmlFor correct sur les formulaires
7. POINTS POSITIFS
Aspect	Detail
Row Level Security (RLS)	Bien implemente sur toutes les tables critiques
Routes protegees	ProtectedRoute.jsx et AdminRoute.jsx correctement configures
Error handling	try-catch dans la majorite des hooks et services
Build config	Pas de sourcemaps en production (sourcemap: false)
Code splitting	Vendor, UI, Charts, PDF, Supabase correctement separes
Responsive design	Bonne utilisation de Tailwind breakpoints, approche mobile-first
.gitignore	Exclut correctement .env, node_modules, dist, fichiers IDE
Routage	Complet, pas de routes mortes, fallback vers "/"
8. PLAN DE CORRECTION RECOMMANDE
Phase 1 : Corrections critiques (securite)
Supprimer les credentials hardcodees de customSupabaseClient.js et utiliser les variables d'environnement
Consolider les deux AuthContext en un seul
Corriger la race condition dans useSubtasks.js
Phase 2 : Corrections haute priorite
Gater le debug panel derriere import.meta.env.DEV
Supprimer/conditionner les console.log en production
Corriger localStorage.clear() -> removeItem selectif
Corriger les setTimeout sans cleanup dans les hooks settings
Deplacer la clef VAPID en variable d'environnement
Phase 3 : Qualite du code
Ajouter des Error Boundaries (au moins un global dans App.jsx)
Completer les dependances manquantes dans les useEffect
Ajouter des schemas Zod pour la validation des donnees avant les appels API
Ameliorer la gestion des erreurs RLS (afficher un message a l'utilisateur)
Phase 4 : i18n
Extraire les ~70+ chaines hardcodees vers les fichiers de traduction
Corriger le melange de langues dans LoginPage
Phase 5 : Fonctionnalites incompletes
Implementer ou retirer QuotesPage (actuellement placeholder)
Connecter ReportGenerator aux donnees reelles
Implementer la logique de sync offline ou retirer la fonctionnalite
Verification
Lancer npm run build pour verifier qu'il n'y a pas d'erreurs de build
Lancer npm run lint pour verifier la qualite du code
Tester manuellement le login/logout (credentials non hardcodees)
Verifier que le debug panel n'apparait plus en mode production
Verifier les traductions en changeant de langue (EN/FR/NL)
Tester les subscriptions realtime (changement rapide de tache)
User approved the plan
Le plan a ete approuve. Je vais maintenant commencer les corrections. Laissez-moi d'abord configurer les taches et lire les fichiers critiques.

Update Todos

Phase 1.1 : Supprimer credentials hardcodees de customSupabaseClient.js

Phase 1.2 : Consolider les deux AuthContext en un seul

Phase 1.3 : Corriger race condition dans useSubtasks.js

Phase 2.1 : Gater le debug panel derriere import.meta.env.DEV

Phase 2.2 : Supprimer/conditionner console.log en production

Phase 2.3 : Corriger localStorage.clear() au logout

Phase 2.4 : Corriger setTimeout sans cleanup dans settings hooks

Phase 2.5 : Deplacer clef VAPID en variable d'environnement

Phase 3.1 : Ajouter Error Boundary global dans App.jsx

Phase 3.2 : Corriger dependances manquantes useEffect

Phase 3.3 : Ameliorer gestion erreurs RLS

Phase 4 : Extraire chaines hardcodees vers i18n

Verification : build et lint