# AUDIT & PLAN D'ACTION — CashPilot
**Date** : 30/01/2026 - 20:07
**Auteur** : Claude Opus 4.5

---

## RAPPORT D'AUDIT COMPLET

### Résumé exécutif
L'application CashPilot a une architecture frontend solide mais souffre de lacunes majeures au niveau de la gestion utilisateur et société. Le code est cohérent visuellement, mais plusieurs modules sont partiellement implémentés ou utilisent des données mockées au lieu de Supabase.

---

### 1. GESTION UTILISATEUR / PROFIL — PARTIELLEMENT FONCTIONNEL

**Ce qui existe :**
- `ProfileSettings.jsx` : Formulaire avec nom, téléphone, adresse, ville, code postal, pays, devise, fuseau horaire, avatar, signature digitale
- `useProfileSettings.js` : Hook connecté à Supabase (table `profiles`), upload avatar/signature fonctionnel
- `useAuth.js` : Inscription avec `full_name`, `company_name`, `role`

**Ce qui manque :**
- Pas de page profil dédiée accessible via la sidebar
- La page Settings n'affiche que 3 onglets (Notifications, Security, Sync) — le profil utilisateur n'y est pas
- Les composants ProfileSettings, BillingSettings, TeamSettings existent mais ne sont importés nulle part
- Pas de lien dans la sidebar vers le profil utilisateur

---

### 2. GESTION SOCIÉTÉ / COMPANY — NON IMPLÉMENTÉ (CRITIQUE)

**Ce qui existe en base :**
- Table `company` définie dans `create-company-tables.sql` avec tous les champs : nom, type (freelance/company), SIRET, TVA, adresse, téléphone, email, site web, logo, coordonnées bancaires (IBAN, BIC)

**Ce qui manque :**
- Aucun hook `useCompany` n'existe
- Aucune page/composant pour gérer la société
- Aucune requête `from('company')` dans tout le code frontend
- La table `company` est définie en SQL mais jamais utilisée par l'application
- Les factures/devis ne peuvent pas récupérer les infos de la société

---

### 3. AUTHENTIFICATION — FONCTIONNEL

- Login/Signup fonctionnels avec Supabase Auth
- Gestion des erreurs (identifiants invalides, email non confirmé, réseau)
- Profil créé dans la table `profiles` à l'inscription
- Rôles supportés : freelance, user, admin
- RLS activé sur toutes les tables

---

### 4. SIDEBAR / NAVIGATION — INCOMPLÈTE

**Pages accessibles :** Dashboard, Clients, Projects, Timesheets, Invoices, Quotes, Suppliers + sous-pages, Reports, Analytics, Settings, Admin (conditionnel)

**Ce qui manque :**
- Pas de lien "Mon Profil" ni "Ma Société" dans la sidebar
- Pas de page Expenses dans la sidebar

---

### 5. DASHBOARD — FONCTIONNEL

- KPIs : Revenue total, Marge, Taux d'occupation
- Graphiques : Revenue mensuel, Revenue par client
- Factures récentes, Timesheets récents
- Actions rapides
- Connecté à Supabase

---

### 6. CLIENTS — FONCTIONNEL (enrichi)

- CRUD complet via useClients hook
- Formulaire enrichi : info générale, adresse, détails commerciaux, bancaire, notes
- Bug addClient/createClient corrigé
- Pas de page profil client détaillée

---

### 7. FOURNISSEURS — FONCTIONNEL (enrichi)

- CRUD complet, formulaire enrichi avec sections
- Page profil fournisseur (SupplierProfile.jsx)
- Gestion produits, services, commandes, statistiques

---

### 8. FACTURES — PARTIELLEMENT FONCTIONNEL

- Page de liste et création existe
- Les factures ne récupèrent pas les infos société du user
- Pas de template PDF avec en-tête société/logo

---

### 9. DEVIS — PARTIELLEMENT FONCTIONNEL (même situation que factures)

---

### 10. DÉPENSES — ABSENT DE LA NAVIGATION

---

### 11. SETTINGS — INCOHÉRENT (CRITIQUE)

4 composants Settings existent :
- ProfileSettings : Complet, connecté Supabase
- BillingSettings : UI complète, 100% mockée
- TeamSettings : UI complète, probablement mockée
- NotificationSettings : UI complète, probablement mockée

Mais SettingsPage.jsx n'utilise AUCUN de ces 4 composants ! Les 4 composants dans settings/ sont orphelins.

---

### 12. BASE DE DONNÉES vs FRONTEND — Incohérences

| Table DB | Hook Frontend | UI Page | État |
|----------|--------------|---------|------|
| profiles | useProfileSettings | ProfileSettings (orphelin) | Non accessible |
| company | AUCUN | AUCUNE | Critique |
| clients | useClients | ClientManager | OK |
| suppliers | useSuppliers | SuppliersPage | OK |
| invoices | useInvoices | InvoicesPage | OK |
| quotes | — | QuotesPage | Partiel |
| expenses | — | Pas dans nav | Partiel |
| projects | useProjects | ProjectsPage | OK |
| timesheets | useTimesheets | TimesheetsPage | OK |
| payment_terms | AUCUN | AUCUNE | Manquant |

---

## PLAN D'ACTION

### Priorité 1 — CRITIQUE
- [ ] 1.1 Créer le hook `useCompany` (CRUD sur table `company`)
- [ ] 1.2 Créer le composant `CompanySettings.jsx` (nom, type, SIRET, TVA, adresse, logo, IBAN)
- [ ] 1.3 Restructurer `SettingsPage.jsx` avec onglets : Profil, Société, Billing, Team, Notifications
- [ ] 1.4 Ajouter "Mon Profil" / "Ma Société" dans la sidebar

### Priorité 2 — IMPORTANT
- [ ] 2.1 Relier les factures/devis aux infos société pour les en-têtes
- [ ] 2.2 Connecter `BillingSettings` à Supabase (remplacer les mocks)
- [ ] 2.3 Ajouter Expenses dans la navigation sidebar

### Priorité 3 — AMÉLIORATION
- [ ] 3.1 Ajouter une page profil client détaillée (comme SupplierProfile)
- [ ] 3.2 Implémenter le hook `usePaymentTerms` pour la table existante
- [ ] 3.3 Nettoyer les fichiers SQL obsolètes (users_profile)
